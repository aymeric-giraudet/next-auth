"use strict";var _react=require("react");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;function ownKeys(a,b){var c=Object.keys(a);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(a);b&&(d=d.filter(function(b){return Object.getOwnPropertyDescriptor(a,b).enumerable})),c.push.apply(c,d)}return c}function _objectSpread(a){for(var b,c=1;c<arguments.length;c++)b=null==arguments[c]?{}:arguments[c],c%2?ownKeys(Object(b),!0).forEach(function(c){_defineProperty(a,c,b[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(b)):ownKeys(Object(b)).forEach(function(c){Object.defineProperty(a,c,Object.getOwnPropertyDescriptor(b,c))});return a}function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}function asyncGeneratorStep(a,b,c,d,e,f,g){try{var h=a[f](g),i=h.value}catch(a){return void c(a)}h.done?b(i):Promise.resolve(i).then(d,e)}function _asyncToGenerator(a){return function(){var b=this,c=arguments;return new Promise(function(d,e){function f(a){asyncGeneratorStep(h,d,e,f,g,"next",a)}function g(a){asyncGeneratorStep(h,d,e,f,g,"throw",a)}var h=a.apply(b,c);f(void 0)})}}var DEFAULT_BASE_URL_COOKIE_NAME="next-auth.base-url",DEFAULT_SITE="",DEFAULT_BASE_PATH="/api/auth",getSession=function(){var a=_asyncToGenerator(function*(){var{req:a}=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{},b=_baseUrl({req:a}),c=a?{headers:{cookie:a.headers.cookie}}:{};return _fetchData("".concat(b,"/session"),c)});return function(){return a.apply(this,arguments)}}(),getProviders=function(){var a=_asyncToGenerator(function*(){var{req:a}=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{},b=_baseUrl({req:a}),c=a?{headers:{cookie:a.headers.cookie}}:{};return _fetchData("".concat(b,"/providers"),c)});return function(){return a.apply(this,arguments)}}(),getCsrfToken=function(){var a=_asyncToGenerator(function*(){var{req:a}=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{},b=_baseUrl({req:a}),c=a?{headers:{cookie:a.headers.cookie}}:{},d=yield _fetchData("".concat(b,"/csrf"),c);return d.csrfToken});return function(){return a.apply(this,arguments)}}(),SessionContext=(0,_react.createContext)(),useSession=a=>{var b=(0,_react.useContext)(SessionContext);return void 0===b?useSessionData(a):b},useSessionData=a=>{var[b,c]=(0,_react.useState)(a),[d,e]=(0,_react.useState)(!0),f=function(){var a=_asyncToGenerator(function*(){try{c(yield getSession()),e(!1)}catch(a){console.error("CLIENT_USE_SESSION_ERROR",a)}});return function(){return a.apply(this,arguments)}}();return(0,_react.useEffect)(()=>{f()},[]),[b,d]},signin=function(){var a=_asyncToGenerator(function*(a,b){if(!a){var f=_baseUrl();return void(window.location="".concat(f,"/signin?callbackUrl=").concat(encodeURIComponent(window.location)))}var c=yield getProviders();if(!c[a]){var g=_baseUrl();window.location="".concat(g,"/signin?callbackUrl=").concat(encodeURIComponent(window.location))}else if("oauth"===c[a].type)window.location="".concat(c[a].signinUrl,"?callbackUrl=").concat(encodeURIComponent(window.location));else{var d={method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:_encodedForm(_objectSpread({csrfToken:yield getCsrfToken(),callbackUrl:window.location},b))},e=yield fetch(c[a].signinUrl,d);window.location=e.url?e.url:window.location}});return function(){return a.apply(this,arguments)}}(),signout=function(){var a=_asyncToGenerator(function*(){var a=_baseUrl(),b={method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:_encodedForm({csrfToken:yield getCsrfToken(),callbackUrl:window.location})},c=yield fetch("".concat(a,"/signout"),b);window.location=c.url?c.url:window.location});return function(){return a.apply(this,arguments)}}(),Provider=(a)=>{var{children:b,session:c}=a,d=useSession(c);return(0,_react.createElement)(SessionContext.Provider,{value:d},b)},_fetchData=function(){var a=_asyncToGenerator(function*(a,b){try{var c=yield fetch(a,b),d=yield c.json();return 0<Object.keys(d).length?d:null}catch(b){return console.error("CLIENT_FETCH_ERROR",a,b),null}});return function(){return a.apply(this,arguments)}}(),_baseUrl=function(){var{req:a}=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{};if(a){var b=a?_parseCookies(a.headers.cookie):null,c=process.env.NEXTAUTH_BASE_URL_COOKIE_NAME||DEFAULT_BASE_URL_COOKIE_NAME,d=b["__Secure-".concat(c)]||b[c],[e]=d?d.split("|"):[null];return e}var f=process.env.NEXTAUTH_SITE||DEFAULT_SITE,g=process.env.NEXTAUTH_BASE_PATH||DEFAULT_BASE_PATH;return"".concat(f).concat(g)},_parseCookies=c=>{if(!c)return{};try{for(var d,e={},f=c.split(";"),a=0;a<f.length;a++)d=f[a].split("="),1<d[0].length&&d[1]&&(e[d[0].trim()]=decodeURIComponent(d[1]));return e}catch(a){return console.error("CLIENT_COOKIE_PARSE_ERROR",a),{}}},_encodedForm=a=>Object.keys(a).map(b=>encodeURIComponent(b)+"="+encodeURIComponent(a[b])).join("&"),_default={session:getSession,providers:getProviders,csrfToken:getCsrfToken,useSession,Provider,signin,signout};exports.default=_default;